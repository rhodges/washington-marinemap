{% extends 'common/panel.html' %}
{% load jsonify %}
{% block title %}Multi-Objective Scenario Report{% endblock %}

{% block panel %}

<script type="text/javascript" charset="utf-8">
lingcod.onShow(function() {

    /*** THE EXTENT REPORTS ***/
    var substrate_extent = {{ substrate_extent|safe }};
    var substrate_data = [[]];
    var substrate_colors = {{ substrate_colors|safe }};
    var series_object_array = [];
    var substrate_series = [];
    var depth_class_extent = {{ depth_class_extent|safe }};
    var depth_class_data = [[]];
    var geomorphology_extent = {{ geomorphology_extent|safe }};
    var geomorphology_data = [[]];
    var obj_short_name = "{{ scenario.input_objective.short_name }}";
    //console.log('obj_short_name is ' + obj_short_name);
    
    //TODO: not sure if the ordering for substrate data and coloring are guaranteed to match here...maybe order by area?
    for (var key in substrate_extent) {
        if (!substrate_extent.hasOwnProperty(key)) { //not sure what this actually does...
            continue;
        }
        substrate_data[0].push([substrate_extent[key],key]);
    }
    for (var key in substrate_colors) {
        if (!substrate_colors.hasOwnProperty(key)) { //not sure what this actually does...
            continue;
        }
        series_object_array.push({ label: key, color: substrate_colors[key] });
        substrate_series.push(substrate_colors[key]);
    }
    for (var key in depth_class_extent) {
        if (!depth_class_extent.hasOwnProperty(key)) { //not sure what this actually does...
            continue;
        }
        depth_class_data[0].push([depth_class_extent[key],key]);
    }  
    for (var key in geomorphology_extent) {
        if (!geomorphology_extent.hasOwnProperty(key)) { //not sure what this actually does...
            continue;
        }
        geomorphology_data[0].push([geomorphology_extent[key],key]);
    }
    var extent_data = [substrate_data,depth_class_data, geomorphology_data];
        
    //var substrate_data = [[[30,'Rock'],[25,'Mud'],[40,'Sand']]];
    var substrate_div = obj_short_name+'_substrates';
    var depth_class_div = obj_short_name+'_depth_classes';
    var geomorphology_div = obj_short_name+'_geomorphologies';
    var extent_divs = [substrate_div, depth_class_div, geomorphology_div];
    
    for (i=0; i<3; i++) {
        if (extent_divs[i] == obj_short_name+'_substrates') {
            series_array = substrate_series;
            varyColor = true;
        } else {
            series_array = [ '#4bb2c5' ];
            varyColor = false;
        }
        chart = $.jqplot(extent_divs[i], extent_data[i], {
            animate: true,
            animateReplot: true,
            seriesDefaults: {
                renderer:$.jqplot.BarRenderer,
                // Show point labels to the right ('e'ast) of each bar.
                // edgeTolerance of -15 allows labels flow outside the grid
                // up to 15 pixels.  If they flow out more than that, they
                // will be hidden.
                pointLabels: {  show: true, 
                                location: 'e', 
                                edgeTolerance: -25,
                                formatString: '%s'
                },
                // Rotate the bar shadow as if bar is lit from top right.
                shadowAngle: 135,
                // Here's where we tell the chart to orient horizontally.
                rendererOptions: {  animation: { 
                                        speed: 1200 
                                    },
                                    barWidth: 25,
                                    barDirection: 'horizontal',
                                    varyBarColor: varyColor
                }
            },
            seriesColors: series_array,
            axes: {
                yaxis: {
                    renderer: $.jqplot.CategoryAxisRenderer,
                    rendererOptions: {  tickRenderer: $.jqplot.AxisTickRenderer, 
                                        tickOptions: {  mark: null,
                                                        fontSize: 12,
                                                        formatString: '%s',
                                                        showLabel: false
                                                     } 
                    }                                    
                },
                xaxis: {
                    min: 0,
                    max: 100,
                    numberTicks: 6
                }
            },
            grid: {
                drawGridlines: false,
                drawBorder: false,
                shadow: false
            }
        });
    };
    
    /*** THE SUBSTRATE REPORTS ***/
    var substrate_percs = {{ substrate_percs|safe }};
    var substrate_perc_data = [];
    
    for (var key in substrate_percs) {
        if (!substrate_percs.hasOwnProperty(key)) { //not sure what this actually does...
            continue;
        }
        substrate_perc_data.push([ [substrate_percs[key],'1'] ]);
    }
    
    //substrate_series = [{ label: 'Sand', color: '#ffeeaa' }, { label: 'Mud', color: 'green' }, { label: 'Rock', color: 'blue' }];
    //console.log(substrate_percs);
    //console.log(substrate_perc_data);
    //console.log(substrate_series);
    //console.log(series_object_array);
    var substrate_perc_chart = $.jqplot('substrate_percentages', substrate_perc_data, {
        animate: true,
        animateReplot: true,
        stackSeries: true,
        seriesDefaults: {
            renderer:$.jqplot.BarRenderer,
            // Show point labels to the right ('e'ast) of each bar.
            // edgeTolerance allows labels to flow outside the grid
            //pointLabels: {  //show: false, 
                            //location: 'e', 
                            //edgeTolerance: -25,
                            //formatString: '%s'
            //},
            // Rotate the bar shadow as if bar is lit from top right.
            shadowAngle: 135,
            // Here's where we tell the chart to orient horizontally.
            rendererOptions: {  animation: { 
                                    speed: 1200 
                                },
                                barWidth: 25,
                                //barPadding: 25,
                                barDirection: 'horizontal',
                                //varyBarColor: true
            }
        },
        series: series_object_array,
        axes: {
            yaxis: {
                renderer: $.jqplot.CategoryAxisRenderer,
                rendererOptions: {  tickRenderer: $.jqplot.AxisTickRenderer, 
                                    tickOptions: {  mark: null,
                                                    fontSize: 12,
                                                    //showLabel: false,
                                                    //formatString: 'test'
                                                 }
                },
                //label: 'Substrates'
            },
            xaxis: {
                min: 0,
                max: 100,
                numberTicks: 6
            }
        },
        grid: {
            drawGridlines: false,
            drawBorder: false,
            shadow: false
        },
        legend: {
          show: true,
          location: 'e',
          placement: 'outside'
        }  
    });
    
}); 

function toggleReport(obj_id, src_id) {
    $("#"+obj_id).fadeToggle(100); //slideToggle
    if ($("#"+src_id).text() == 'Show Report') { 
        $("#"+src_id).text('Hide Report'); 
    } else { 
        $("#"+src_id).text('Show Report'); 
    }
}; 
  
function toggleReports(obj_id, src_id) {
    $("#"+obj_id).fadeToggle(100); //slideToggle
    if ($("#"+src_id).text() == 'Show Reports') { 
        $("#"+src_id).text('Hide Reports'); 
    } else { 
        $("#"+src_id).text('Show Reports'); 
    }
}; 
  
</script>

<h2>{{scenario.input_objective.name}} Report</h2>

<h3>Substrates (as a percentage of the Extent) 
<small>(<a id="toggle_substrate_report" href="javascript:toggleReport('{{scenario.input_objective.short_name}}_substrates', 'toggle_substrate_report');">Hide Report</a>)</small></h3>
<div id="{{scenario.input_objective.short_name}}_substrates" class="jqPlot" style="height:{{substrate_extent_table_height}}px;width:400px;display "></div>
<p></p>

<h3>Depth Classes (as a percentage of the Extent) 
<small>(<a id="toggle_depth_class_report" href="javascript:toggleReport('{{scenario.input_objective.short_name}}_depth_classes', 'toggle_depth_class_report');">Hide Report</a>)</small></h3>
<div id="{{scenario.input_objective.short_name}}_depth_classes" class="jqPlot" style="height:{{depth_class_extent_table_height}}px;width:400px;display "></div>
<p></p>

<h3>Geomorphologies (as a percentage of the Extent)  
<small>(<a id="toggle_geomorphology_report" href="javascript:toggleReport('{{scenario.input_objective.short_name}}_geomorphologies', 'toggle_geomorphology_report');">Hide Report</a>)</small></h3>
<div id="{{scenario.input_objective.short_name}}_geomorphologies" class="jqPlot" style="height:{{geomorphology_extent_table_height}}px;width:400px;display "></div>
<p></p>

<h3>&nbsp;</h3>

<h3>Substrate Reports
<small>(<a id="toggle_substrate_reports" href="javascript:toggleReports('substrate_percentages', 'toggle_substrate_reports');">Show Reports</a>)</small></h3>
<div id="substrate_percentages" class="jqPlot" style="height:80px;width:400px"></div>
<p></p>

<h3>Depth Class Reports
<small>(<a id="toggle_depth_class_reports" href="javascript:toggleReports('{{scenario.input_objective.short_name}}_depth_class_reports', 'toggle_depth_class_reports');">Show Reports</a>)</small></h3>
<div id="{{scenario.input_objective.short_name}}_depth_class_reports" class="jqPlot" style="height:{{depth_class_extent_table_height}}px;width:400px;display:none"></div>
<p></p>

<h3>Geomorphology Reports
<small>(<a id="toggle_geomorphology_reports" href="javascript:toggleReports('{{scenario.input_objective.short_name}}_geomorphology_reports', 'toggle_geomorphology_reports');">Show Reports</a>)</small></h3>
<div id="{{scenario.input_objective.short_name}}_geomorphology_reports" class="jqPlot" style="height:{{geomorphology_extent_table_height}}px;width:400px;display:none"></div>
<p></p>




{% endblock %}