{% extends 'common/panel.html' %}
{% load jsonify %}
{% block title %}Multi-Objective Scenario Report{% endblock %}

{% block panel %}

<script type="text/javascript" charset="utf-8">
lingcod.onShow(function() {

    var obj_short_name = "{{ scenario.input_objective.short_name }}";
    var bar_height = {{ bar_height }};
    
    
    /*** THE EXTENT REPORTS ***/
    
    var substrate_extent = {{ substrate_jextent|safe }};
    var substrate_data = [[]];
    var substrate_colors = {{ substrate_jcolors|safe }};
    var series_object_array = [];
    var substrate_series = [];
    var depth_class_extent = {{ depth_class_jextent|safe }};
    var depth_class_data = [[]];
    var geomorphology_extent = {{ geomorphology_jextent|safe }};
    var geomorphology_data = [[]];
    
    //Not sure if the ordering for substrate data and coloring are guaranteed to match here...maybe order by area?
    //I believe ordering is working now for substrate data...need to verify...
    $.each(substrate_extent, function( index, extent_tuple) {
        substrate_data[0].push( [extent_tuple[0], extent_tuple[1]] );
        $.each(substrate_colors, function( index, color_tuple ) {
            if (color_tuple[0] == extent_tuple[1]) {
                substrate_series.push( color_tuple[1] );
            }
        });
    });
    $.each(substrate_colors, function( index, tuple) {
        series_object_array.push( { label: tuple[0], color: tuple[1] } );
    });
    for (var key in depth_class_extent) {
        if (!depth_class_extent.hasOwnProperty(key)) { //not sure what this actually does...
            continue;
        }
        depth_class_data[0].push([depth_class_extent[key],key]);
    }  
    for (var key in geomorphology_extent) {
        if (!geomorphology_extent.hasOwnProperty(key)) { //not sure what this actually does...
            continue;
        }
        geomorphology_data[0].push([geomorphology_extent[key],key]);
    }
    var extent_data = [substrate_data,depth_class_data, geomorphology_data];
        
    //var substrate_data = [[[30,'Rock'],[25,'Mud'],[40,'Sand']]];
    var substrate_div = obj_short_name+'_substrates';
    var depth_class_div = obj_short_name+'_depth_classes';
    var geomorphology_div = obj_short_name+'_geomorphologies';
    var extent_divs = [substrate_div, depth_class_div, geomorphology_div];
    //TODO:  no need for the loop here anymore...
    for (i=0; i<3; i++) {
        if (extent_divs[i] == obj_short_name+'_substrates') {
            series_colors = substrate_series;
            varyColor = true;
        } else {
            series_colors = [ '#4bb2c5' ];
            varyColor = false;
        }
        chart = createChart(extent_divs[i], extent_data[i], series_colors);
    };
    
    
    /*** THE SUBSTRATE REPORTS ***/
    
    // Substrate Percentages
    var substrate_percs = {{ substrate_jpercs|safe }};
    var substrate_perc_data = [[]];
    series_colors = [];
    //console.log(substrate_percs);
    $.each(substrate_percs, function( index, tuple) {
        substrate_perc_data[0].push( [tuple[0], tuple[1]] );
        $.each(substrate_colors, function( index, color_tuple ) {
            if (color_tuple[0] == tuple[1]) {
                series_colors.push( color_tuple[1] );
            }
        });
    });
    chart = createChart(obj_short_name+'_substrate_percentages', substrate_perc_data, series_colors);
    
    
    // Substrate Depth Class 
    var substrate_dc_stats = {{ substrate_dc_jstats|safe }};
    var substrate_dc_data = [];
    var substrate_dc_divs = [];
    var substrate_dc_len = 0;
    for (var sub in substrate_dc_stats) {
        if (!substrate_dc_stats.hasOwnProperty(sub)) { //not sure what this actually does...
            continue;
        }
        dc_data = [[]];
        for (var dc in substrate_dc_stats[sub]) {
            if (!substrate_dc_stats[sub].hasOwnProperty(dc)) {
                continue;
            }
            dc_data[0].push( [substrate_dc_stats[sub][dc], dc] );
        }
        substrate_dc_data.push(dc_data);
        substrate_dc_divs.push(obj_short_name+'_'+sub+'_dc');
        substrate_dc_len++;
    }  
    for (i=0; i<substrate_dc_len; i++) {
        series_colors = [ '#4bb2c5' ];
        chart = createChart(substrate_dc_divs[i], substrate_dc_data[i], series_colors);
    };
    
    
    // Substrate Geomorphology 
    var substrate_geo_stats = {{ substrate_geo_jstats|safe }};
    var substrate_geo_data = [];
    var substrate_geo_divs = [];
    var substrate_geo_len = 0;
    for (var sub in substrate_geo_stats) {
        if (!substrate_geo_stats.hasOwnProperty(sub)) { //not sure what this actually does...
            continue;
        }
        geo_data = [[]];
        for (var geo in substrate_geo_stats[sub]) {
            if (!substrate_geo_stats[sub].hasOwnProperty(geo)) {
                continue;
            }
            geo_data[0].push( [substrate_geo_stats[sub][geo], geo] );
        }
        substrate_geo_data.push(geo_data);
        substrate_geo_divs.push(obj_short_name+'_'+sub+'_geo');
        substrate_geo_len++;
    }  
    for (i=0; i<substrate_geo_len; i++) {
        var height = bar_height * substrate_geo_data[i][0].length + bar_height;
        $('#'+substrate_geo_divs[i]).height(height);
        series_colors = [ '#4bb2c5' ];
        chart = createChart(substrate_geo_divs[i], substrate_geo_data[i], series_colors);
    };
    
    
    //Chart drawing function 
    function createChart(div, data, series_colors) {
        chart = $.jqplot(div, data, {
            animate: true,
            animateReplot: true,
            seriesDefaults: {
                renderer:$.jqplot.BarRenderer,
                // Show point labels to the right ('e'ast) of each bar.
                // edgeTolerance of -15 allows labels flow outside the grid
                // up to 15 pixels.  If they flow out more than that, they
                // will be hidden.
                pointLabels: {  show: true, 
                                location: 'e', 
                                edgeTolerance: -25,
                                formatString: '%s'
                },
                // Rotate the bar shadow as if bar is lit from top right.
                shadowAngle: 145,
                // Here's where we tell the chart to orient horizontally.
                rendererOptions: {  animation: { 
                                        speed: 1500 
                                    },
                                    barWidth: 25,
                                    barPadding: 20,
                                    barMargin: 1,
                                    barDirection: 'horizontal',
                                    varyBarColor: true
                }
            },
            seriesColors: series_colors,
            axes: {
                yaxis: {
                    renderer: $.jqplot.CategoryAxisRenderer,
                    rendererOptions: {  tickRenderer: $.jqplot.AxisTickRenderer, 
                                        tickOptions: {  mark: null,
                                                        fontSize: 12
                                        } 
                    }                                    
                },
                xaxis: {
                    min: 0,
                    max: 100,
                    numberTicks: 6,
                    tickRenderer: $.jqplot.AxisTickRenderer, 
                    tickOptions: {  fontSize: 10 } 
                }
            },
            grid: {
                drawGridlines: false,
                drawBorder: false,
                shadow: false
            }
        });
        return chart;
    }
    
    
    //toggleReports(obj_short_name+'_extent_reports', 'toggle_extent_reports');
    toggleReports(obj_short_name+'_substrate_reports', 'toggle_substrate_reports');
    toggleReports(obj_short_name+'_depth_class_reports', 'toggle_depth_class_reports');
    toggleReports(obj_short_name+'_geomorphology_reports', 'toggle_geomorphology_reports');
}); 

function toggleReport(obj_id, src_id) {
    $("#"+obj_id).fadeToggle(100); //slideToggle
    if ($("#"+src_id).text() == 'Show') { 
        $("#"+src_id).text('Hide'); 
    } else { 
        $("#"+src_id).text('Show'); 
    }
}; 
  
function toggleReports(obj_id, src_id) {
    $("#"+obj_id).fadeToggle(100); //slideToggle
    if ($("#"+src_id).text() == 'Show') { 
        $("#"+src_id).text('Hide'); 
    } else { 
        $("#"+src_id).text('Show'); 
    }
}; 


  
</script>

<h2>Extent 
<small><small>[<a id="toggle_extent_reports" href="javascript:toggleReports('{{scenario.input_objective.short_name}}_extent_reports', 'toggle_extent_reports');">Hide</a>]</small></small></h2>
<div id="{{scenario.input_objective.short_name}}_extent_reports">

<h3>Substrates (as a percentage of the Extent) 
<small><small>[<a id="toggle_substrate_report" href="javascript:toggleReport('{{scenario.input_objective.short_name}}_substrates', 'toggle_substrate_report');">Hide</a>]</small></small></h3>
<div id="{{scenario.input_objective.short_name}}_substrates" class="jqPlot" style="height:{{substrate_extent_table_height}}px;width:400px;display "></div>
<p></p>

<h3>Depth Classes (as a percentage of the Extent) 
<small><small>[<a id="toggle_depth_class_report" href="javascript:toggleReport('{{scenario.input_objective.short_name}}_depth_classes', 'toggle_depth_class_report');">Hide</a>]</small></small></h3>
<div id="{{scenario.input_objective.short_name}}_depth_classes" class="jqPlot" style="height:{{depth_class_extent_table_height}}px;width:400px;display "></div>
<p></p>

<h3>Geomorphologies (as a percentage of the Extent)  
<small><small>[<a id="toggle_geomorphology_report" href="javascript:toggleReport('{{scenario.input_objective.short_name}}_geomorphologies', 'toggle_geomorphology_report');">Hide</a>]</small></small></h3>
<div id="{{scenario.input_objective.short_name}}_geomorphologies" class="jqPlot" style="height:{{geomorphology_extent_table_height}}px;width:400px;display "></div>
<p></p>

<h3>&nbsp;</h3>
</div>


<h2>Substrate 
<small><small>[<a id="toggle_substrate_reports" href="javascript:toggleReports('{{scenario.input_objective.short_name}}_substrate_reports', 'toggle_substrate_reports');">Hide</a>]</small></small></h2>
<div id="{{scenario.input_objective.short_name}}_substrate_reports">

<h3>Substrates (as a percentage of the Scenario) 
<small><small>[<a id="toggle_substrate_reports" href="javascript:toggleReport('{{scenario.input_objective.short_name}}_substrate_percentages', 'toggle_substrate_reports');">Hide</a>]</small></small></h3>
<div id="{{scenario.input_objective.short_name}}_substrate_percentages" class="jqPlot" style="height:{{substrate_extent_table_height}}px;width:400px"></div>

{% for substrate in substrate_r %}
<h3>{{substrate}} -- Depth Classes
<small><small>[<a id="toggle_{{substrate}}_depth_class" href="javascript:toggleReport('{{scenario.input_objective.short_name}}_{{substrate}}_dc', 'toggle_{{substrate}}_depth_class');">Hide</a>]</small></small></h3>
<div id="{{scenario.input_objective.short_name}}_{{substrate}}_dc" class="jqPlot" style="height:{{depth_class_extent_table_height}}px;width:400px"></div>

<h3>{{substrate}} -- Geomorphology
<small><small>[<a id="toggle_{{substrate}}_geomorphology" href="javascript:toggleReport('{{scenario.input_objective.short_name}}_{{substrate}}_geo', 'toggle_{{substrate}}_geomorphology');">Hide</a>]</small></small></h3>
<div id="{{scenario.input_objective.short_name}}_{{substrate}}_geo" class="jqPlot" style="height:{{geomorphology_extent_table_height}}px;width:400px"></div>

{% endfor %}
<p></p>
</div>


<h2>Depth Class 
<small><small>[<a id="toggle_depth_class_reports" href="javascript:toggleReports('depth_class_reports', 'toggle_depth_class_reports');">Hide</a>]</small></small></h2>
<div id="depth_class_reports">
<p></p>
</div>


<h2>Geomorphology 
<small><small>[<a id="toggle_geomorphology_reports" href="javascript:toggleReports('geomorphology_reports', 'toggle_geomorphology_reports');">Hide</a>]</small></small></h2>
<div id="geomorphology_reports">
<p></p>
</div>




{% endblock %}