{% extends 'common/panel.html' %}
{% load jsonify %}
{% block title %}Multi-Objective Scenario Report{% endblock %}

{% block panel %}

<script type="text/javascript" charset="utf-8">
lingcod.onShow(function() {

    var obj_short_name = "{{ scenario.input_objective.short_name }}";
    var bar_height = {{ bar_height }};
    
    
    /*** THE SCENARIO REPORTS ***/
    
    var substrate_extent = {{ substrate_jextent|safe }};
    var substrate_data = [[]];
    var series_object_array = [];
    var substrate_series = [];
    
    var exposure_extent = {{ exposure_jextent|safe }};
    var exposure_data = [[]];
    
    var ecosystem_extent = {{ ecosystem_jextent|safe }};
    var ecosystem_data = [[]];
    
    // Substrate Scenario Chart
    $.each(substrate_extent, function( index, extent_tuple) {
        substrate_data[0].push( [extent_tuple[0], extent_tuple[1], extent_tuple[2]] );
    });
    
    var substrate_div = obj_short_name+'_substrates';
    var height = bar_height * substrate_data[0].length + bar_height;
    $('#'+substrate_div).height(height);
    chart = createChart(substrate_div, substrate_data); 
    
    // Exposure Scenario Chart
    $.each(exposure_extent, function( index, extent_tuple) {
        exposure_data[0].push( [extent_tuple[0], extent_tuple[1], extent_tuple[2]] );
    });
        
    var exposure_div = obj_short_name+'_exposures';
    height = bar_height * exposure_data[0].length + bar_height;
    $('#'+exposure_div).height(height);
    chart = createChart(exposure_div, exposure_data); 
    
    // Ecosystem Scenario Chart
    $.each(ecosystem_extent, function( index, extent_tuple) {
        ecosystem_data[0].push( [extent_tuple[0], extent_tuple[1], extent_tuple[2]] );
    });
    var ecosystem_div = obj_short_name+'_ecosystems';
    height = bar_height * ecosystem_data[0].length + bar_height;
    $('#'+ecosystem_div).height(height);
    chart = createChart(ecosystem_div, ecosystem_data); 
        
    
    /*** THE SUBSTRATE REPORTS ***/
    
    // Substrate Exposure
    var substrate_exp_stats = {{ substrate_exp_jstats|safe }};
    div_suffix = 'exp';
    process_stats_and_create_charts(substrate_exp_stats, div_suffix);
    
    // Substrate Ecosystem 
    var substrate_eco_stats = {{ substrate_eco_jstats|safe }};
    div_suffix = 'eco';
    process_stats_and_create_charts(substrate_eco_stats, div_suffix);
    
    
    /** THE Exposure REPORTS **/
    
    // Exposure Substrates 
    var exposure_sub_stats = {{ exposure_sub_jstats|safe }};
    div_suffix = 'sub';
    process_stats_and_create_charts(exposure_sub_stats, div_suffix);
    
    // Exposure Ecosystems 
    var exposure_eco_stats = {{ exposure_eco_jstats|safe }};
    div_suffix = 'eco';
    process_stats_and_create_charts(exposure_eco_stats, div_suffix);
    
    
    /** THE Ecosystem REPORTS **/
    
    // Ecosystem Substrates 
    var ecosystem_sub_stats = {{ ecosystem_sub_jstats|safe }};
    div_suffix = 'sub';
    process_stats_and_create_charts(ecosystem_sub_stats, div_suffix);
    
    // Ecosystem Exposures 
    var ecosystem_exp_stats = {{ ecosystem_exp_jstats|safe }};
    div_suffix = 'exp';
    process_stats_and_create_charts(ecosystem_exp_stats, div_suffix);
    
    
    /** CHART FUNCTIONS **/
    
    //creates array of series data, array of div names, and generates bar charts
    function process_stats_and_create_charts(stats, div_suffix) {
        var data = [];
        var divs = [];
        var len = 0;
        for (var key in stats) {
            if (!stats.hasOwnProperty(key)) { //not sure what this actually does...
                continue;
            }
            series_data = [[]];
            for (var inner_key in stats[key]) {
                if (!stats[key].hasOwnProperty(inner_key)) {
                    continue;
                }
                series_data[0].push( [stats[key][inner_key][0], inner_key, stats[key][inner_key][1]] );
            }
            data.push(series_data);
            divs.push(obj_short_name+'_'+key+'_'+div_suffix); 
            len++;
        };
        //console.log(divs);  
        for (i=0; i<len; i++) {
            var height = bar_height * data[i][0].length + bar_height;
            $('#'+divs[i]).height(height);
            chart = createChart(divs[i], data[i]); 
        };
    }
    
    
    //Chart drawing function 
    function createChart(div, data ) { //, series_colors) {
        //console.log(div);
        //console.log(data);
        tooltip_output = 'current output...';
        //console.log(tooltip_output);
        chart = $.jqplot(div, data, {
            animate: true,
            animateReplot: true,
            seriesDefaults: {
                renderer:$.jqplot.BarRenderer,
                // Show point labels to the right ('e'ast) of each bar.
                // edgeTolerance of -15 allows labels flow outside the grid
                // up to 15 pixels.  If they flow out more than that, they
                // will be hidden.
                pointLabels: {  show: true, 
                                location: 'e', 
                                edgeTolerance: -25,
                                formatString: '%s'
                },
                // Rotate the bar shadow as if bar is lit from top right.
                shadowAngle: 145,
                // Here's where we tell the chart to orient horizontally.
                rendererOptions: {  animation: { 
                                        speed: 1500 
                                    },
                                    barWidth: 25,
                                    barPadding: 20,
                                    barMargin: 1,
                                    barDirection: 'horizontal',
                                    //varyBarColor: true
                }
            },
            //seriesColors: series_colors,
            highlighter: {
                show: true,
                tooltipOffset: 7,
                tooltipLocation: 'n',
                formatString: tooltip_output,
                showMarker: false
            },
            axes: {
                yaxis: {
                    renderer: $.jqplot.CategoryAxisRenderer,
                    rendererOptions: {  tickRenderer: $.jqplot.AxisTickRenderer, 
                                        tickOptions: {  mark: null,
                                                        fontSize: 12
                                        } 
                    }                                    
                },
                xaxis: {
                    min: 0,
                    max: 100,
                    numberTicks: 6,
                    tickRenderer: $.jqplot.AxisTickRenderer, 
                    tickOptions: {  fontSize: 10 } 
                }
            },
            grid: {
                drawGridlines: false,
                drawBorder: false,
                shadow: false
            }
        });
        return chart;
    }
    
    
    //toggleReports(obj_short_name+'_extent_reports', 'toggle_extent_reports');
    toggleReports(obj_short_name+'_substrate_reports', 'toggle_'+obj_short_name+'_substrate_reports');
    toggleReports(obj_short_name+'_exposure_reports', 'toggle_'+obj_short_name+'_exposure_reports');
    toggleReports(obj_short_name+'_ecosystem_reports', 'toggle_'+obj_short_name+'_ecosystem_reports');
}); 

function toggleReport(obj_id, src_id) {
    $("#"+obj_id).fadeToggle(100); //slideToggle
    if ($("#"+src_id).text() == 'Show') { 
        $("#"+src_id).text('Hide'); 
    } else { 
        $("#"+src_id).text('Show'); 
    }
}; 
  
function toggleReports(obj_id, src_id) {
    $("#"+obj_id).fadeToggle(100); //slideToggle
    if ($("#"+src_id).text() == 'Show') { 
        $("#"+src_id).text('Hide'); 
    } else { 
        $("#"+src_id).text('Show'); 
    }
}; 


  
</script>

<h2>Scenario 
<small><small>[<a id="toggle_{{scenario.input_objective.short_name}}_extent_reports" href="javascript:toggleReports('{{scenario.input_objective.short_name}}_extent_reports', 'toggle_{{scenario.input_objective.short_name}}_extent_reports');">Hide</a>]</small></small></h2>
<div id="{{scenario.input_objective.short_name}}_extent_reports">

<h3>Substrates (as a percentage of the scenario output) 
<small><small>[<a id="toggle_{{scenario.input_objective.short_name}}_substrate_report" href="javascript:toggleReport('{{scenario.input_objective.short_name}}_substrates', 'toggle_{{scenario.input_objective.short_name}}_substrate_report');">Hide</a>]</small></small></h3>
<div id="{{scenario.input_objective.short_name}}_substrates" class="jqPlot" style="width:400px;display "></div>
<p></p>

<h3>Exposures (as a percentage of the scenario output) 
<small><small>[<a id="toggle_{{scenario.input_objective.short_name}}_exposure_report" href="javascript:toggleReport('{{scenario.input_objective.short_name}}_exposures', 'toggle_{{scenario.input_objective.short_name}}_exposure_report');">Hide</a>]</small></small></h3>
<div id="{{scenario.input_objective.short_name}}_exposures" class="jqPlot" style="width:400px;display "></div>
<p></p>

<h3>Ecosystems (as a percentage of the scenario output) 
<small><small>[<a id="toggle_{{scenario.input_objective.short_name}}_ecosystem_report" href="javascript:toggleReport('{{scenario.input_objective.short_name}}_ecosystems', 'toggle_{{scenario.input_objective.short_name}}_ecosystem_report');">Hide</a>]</small></small></h3>
<div id="{{scenario.input_objective.short_name}}_ecosystems" class="jqPlot" style="width:400px;display "></div>
<p></p>

<h3>&nbsp;</h3>
</div>

<h2>Substrate 
<small><small>[<a id="toggle_{{scenario.input_objective.short_name}}_substrate_reports" href="javascript:toggleReports('{{scenario.input_objective.short_name}}_substrate_reports', 'toggle_{{scenario.input_objective.short_name}}_substrate_reports');">Hide</a>]</small></small></h2>
<div id="{{scenario.input_objective.short_name}}_substrate_reports">

{% for substrate in substrate_list_reverse %}
<h3>Exposures (as a percentage of <b>{{substrate.name}}</b>)
<small><small>[<a id="toggle_{{scenario.input_objective.short_name}}_{{substrate.short_name}}_exposure" href="javascript:toggleReport('{{scenario.input_objective.short_name}}_{{substrate.short_name}}_exp', 'toggle_{{scenario.input_objective.short_name}}_{{substrate.short_name}}_exposure');">Hide</a>]</small></small></h3>
<div id="{{scenario.input_objective.short_name}}_{{substrate.short_name}}_exp" class="jqPlot" style="width:400px"></div>

<h3>Ecosystems (as a percentage of <b>{{substrate.name}}</b>)
<small><small>[<a id="toggle_{{scenario.input_objective.short_name}}_{{substrate.short_name}}_ecosystem" href="javascript:toggleReport('{{scenario.input_objective.short_name}}_{{substrate.short_name}}_eco', 'toggle_{{scenario.input_objective.short_name}}_{{substrate.short_name}}_ecosystem');">Hide</a>]</small></small></h3>
<div id="{{scenario.input_objective.short_name}}_{{substrate.short_name}}_eco" class="jqPlot" style="width:400px"></div>

{% endfor %}
<p></p>
</div>

<h2>Exposure 
<small><small>[<a id="toggle_{{scenario.input_objective.short_name}}_exposure_reports" href="javascript:toggleReports('{{scenario.input_objective.short_name}}_exposure_reports', 'toggle_{{scenario.input_objective.short_name}}_exposure_reports');">Hide</a>]</small></small></h2>
<div id="{{scenario.input_objective.short_name}}_exposure_reports">

{% for exposure in exposure_list_reverse %}
<h3>Substrate (as a percentage of <b>{{exposure.name}}</b>)
<small><small>[<a id="toggle_{{scenario.input_objective.short_name}}_{{exposure.short_name}}_substrate" href="javascript:toggleReport('{{scenario.input_objective.short_name}}_{{exposure.short_name}}_sub', 'toggle_{{scenario.input_objective.short_name}}_{{exposure}}_substrate');">Hide</a>]</small></small></h3>
<div id="{{scenario.input_objective.short_name}}_{{exposure.short_name}}_sub" class="jqPlot" style="width:400px"></div>

<h3>Ecosystems (as a percentage of <b>{{exposure.name}}</b>)
<small><small>[<a id="toggle_{{scenario.input_objective.short_name}}_{{exposure.short_name}}_ecosystem" href="javascript:toggleReport('{{scenario.input_objective.short_name}}_{{exposure.short_name}}_eco', 'toggle_{{scenario.input_objective.short_name}}_{{exposure.short_name}}_ecosystem');">Hide</a>]</small></small></h3>
<div id="{{scenario.input_objective.short_name}}_{{exposure.short_name}}_eco" class="jqPlot" style="width:400px"></div>

{% endfor %}
<p></p>
</div>

<h2>Ecosystems 
<small><small>[<a id="toggle_{{scenario.input_objective.short_name}}_ecosystem_reports" href="javascript:toggleReports('{{scenario.input_objective.short_name}}_ecosystem_reports', 'toggle_{{scenario.input_objective.short_name}}_ecosystem_reports');">Hide</a>]</small></small></h2>
<div id="{{scenario.input_objective.short_name}}_ecosystem_reports">

{% for ecosystem in ecosystem_list_reverse %}
<h3>Substrates (as a percentage of <b>{{ecosystem.name}}</b>)
<small><small>[<a id="toggle_{{scenario.input_objective.short_name}}_{{ecosystem.short_name}}_substrate" href="javascript:toggleReport('{{scenario.input_objective.short_name}}_{{ecosystem.short_name}}_sub', 'toggle_{{scenario.input_objective.short_name}}_{{ecosystem.short_name}}_substrate');">Hide</a>]</small></small></h3>
<div id="{{scenario.input_objective.short_name}}_{{ecosystem.short_name}}_sub" class="jqPlot" style="width:400px"></div>

<h3>Exposures (as a percentage of <b>{{ecosystem.name}}</b>)
<small><small>[<a id="toggle_{{scenario.input_objective.short_name}}_{{ecosystem.short_name}}_exposure" href="javascript:toggleReport('{{scenario.input_objective.short_name}}_{{ecosystem.short_name}}_exp', 'toggle_{{scenario.input_objective.short_name}}_{{ecosystem.short_name}}_exposure');">Hide</a>]</small></small></h3>
<div id="{{scenario.input_objective.short_name}}_{{ecosystem.short_name}}_exp" class="jqPlot" style="width:400px"></div>

{% endfor %}
<p></p>
</div>

{% endblock %}